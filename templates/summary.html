<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Financial Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" type="image/png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="dashboard-page">
  <header class="main-header">
    <img src="{{ url_for('static', filename='logo.png') }}" class="logo-img" alt="Logo">
    <h3>{{ user.username }} — Financial Summary</h3>
  </header>
  <main class="dashboard-content">
    <div class="welcome-box">
      <h2>Interactive Financial Dashboard</h2>
      <p>See how your income, expenses, and savings evolve over time.</p>
    </div>
    <div class="grid">
      <div class="dashboard-card"><h4>Monthly Income vs Expense</h4><canvas id="barChart"></canvas></div>
      <div class="dashboard-card"><h4>Expense Trend Over Time</h4><canvas id="lineChart"></canvas></div>
      <div class="dashboard-card"><h4>Expense Breakdown by Category</h4><canvas id="expensePie"></canvas></div>
      <div class="dashboard-card"><h4>Income Breakdown by Source</h4><canvas id="incomePie"></canvas></div>
    </div>
    <div class="text-center mt-5">
      <button id="refreshBtn" class="btn-primary">
        <i class="bi bi-arrow-repeat"></i> Refresh Data
      </button>
      <a href="/dashboard" class="btn-card-outline" style="padding:0.8rem 2rem;">
        <i class="bi bi-arrow-left"></i> Back to Dashboard
      </a>
    </div>
  </main>
  <script>
    const barCtx = document.getElementById('barChart');
    const lineCtx = document.getElementById('lineChart');
    const expPieCtx = document.getElementById('expensePie');
    const incPieCtx = document.getElementById('incomePie');
    let barChart, lineChart, expensePie, incomePie;
    async function loadSummaryData() {
      const res = await fetch('/summary-data');
      const result = await res.json();
      if (result.status !== "success" || !result.data.months) {
        alert("No data available yet. Add your income and expenses first!");
        return;
      }
      const data = result.data;
      [barChart, lineChart, expensePie, incomePie].forEach(c => c && c.destroy());
      barChart = new Chart(barCtx, {
        type: 'bar',
        data: {
          labels: data.months,
          datasets: [
            { label: 'Income (₹)', data: data.income, backgroundColor: 'rgba(75, 192, 192, 0.7)' },
            { label: 'Expense (₹)', data: data.expense, backgroundColor: 'rgba(255, 99, 132, 0.7)' }
          ]
        },
        options: { responsive: true, plugins: { legend: { position: 'top' } } }
      });
      lineChart = new Chart(lineCtx, {
        type: 'line',
        data: {
          labels: data.months,
          datasets: [{
            label: 'Monthly Expense Trend (₹)',
            data: data.expense,
            borderColor: '#ff6384',
            backgroundColor: 'rgba(255, 99, 132, 0.3)',
            fill: true,
            tension: 0.3
          }]
        },
        options: { responsive: true, plugins: { legend: { position: 'top' } } }
      });
      expensePie = new Chart(expPieCtx, {
        type: 'pie',
        data: {
          labels: data.expense_categories,
          datasets: [{ data: data.expense_amounts, backgroundColor: ['#ff6384','#36a2eb','#ffcd56','#4bc0c0','#9966ff','#ff9f40'] }]
        }
      });
      incomePie = new Chart(incPieCtx, {
        type: 'pie',
        data: {
          labels: data.income_categories,
          datasets: [{ data: data.income_amounts, backgroundColor: ['#4bc0c0','#36a2eb','#9966ff','#ffcd56','#ff9f40','#ff6384'] }]
        }
      });
    }
    document.getElementById('refreshBtn').addEventListener('click', loadSummaryData);
    window.onload = loadSummaryData;
  </script>
</body>
</html>
