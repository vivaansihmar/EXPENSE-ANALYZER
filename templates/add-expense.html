<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Sections & Entries | Expense Manager</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    /* Add page-specific styling */
    .section-box {
      background: var(--bg-1);
      border: 1px solid var(--glass);
      border-radius: var(--card-radius);
      padding: 24px;
      margin-bottom: 32px;
      box-shadow: var(--shadow);
      transition: 0.3s;
    }

    .section-box:hover {
      transform: translateY(-2px);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .entries-list {
      margin-top: 10px;
      padding-left: 10px;
      border-left: 3px solid var(--accent);
    }

    .entry-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      padding: 8px 14px;
      border-radius: 8px;
      margin-bottom: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .entry-item span {
      font-weight: 500;
    }

    .delete-btn {
      background: none;
      border: none;
      color: #b33;
      cursor: pointer;
    }

    .delete-btn:hover {
      color: #ff5c5c;
    }

    .add-entry-form {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .add-entry-form input {
      flex: 1;
    }
  </style>
</head>

<body class="dashboard-page">
  <!-- Header -->
  <header class="main-header">
    <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo-img">
    <h3>Expense Manager — Add & Organize</h3>
  </header>

  <main class="dashboard-content">
    <div class="welcome-box">
      <h2>Manage Your Finances</h2>
      <p>Add sections (like Salary, SIPs, or Home Expenses) and track entries under them.</p>
    </div>

    <!-- Create Section -->
    <div class="auth-container" id="add-section">
      <h3 class="form-title">Create a New Section</h3>
      <form id="sectionForm">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-folder-plus"></i></span>
          <input type="text" id="sectionName" class="form-control" placeholder="e.g. Salary, SIPs, Home Expenses" required>
        </div>
        <button type="submit" class="btn-primary">Add Section</button>
      </form>
    </div>

    <!-- Dynamic Sections Display -->
    <div id="sectionsContainer"></div>
  </main>

  <!-- JS for Dynamic Behavior -->
  <script>
    const sectionForm = document.getElementById('sectionForm');
    const sectionNameInput = document.getElementById('sectionName');
    const sectionsContainer = document.getElementById('sectionsContainer');

    const sections = []; // temporary store until backend added

    // Add new section
    sectionForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const sectionName = sectionNameInput.value.trim();
      if (!sectionName) return;
      const section = { id: Date.now(), name: sectionName, entries: [] };
      sections.push(section);
      sectionNameInput.value = '';
      renderSections();
    });

    // Add new entry
    function addEntry(sectionId, title, amount) {
      const section = sections.find(s => s.id === sectionId);
      if (section) {
        section.entries.push({ id: Date.now(), title, amount });
        renderSections();
      }
    }

    // Delete entry
    function deleteEntry(sectionId, entryId) {
      const section = sections.find(s => s.id === sectionId);
      section.entries = section.entries.filter(e => e.id !== entryId);
      renderSections();
    }

    // Render sections dynamically
    function renderSections() {
      sectionsContainer.innerHTML = '';
      sections.forEach(section => {
        const div = document.createElement('div');
        div.classList.add('section-box');

        div.innerHTML = `
          <div class="section-header">
            <h4>${section.name}</h4>
            <button class="delete-btn" onclick="deleteSection(${section.id})">
              <i class="bi bi-trash"></i>
            </button>
          </div>
          <div class="add-entry-form">
            <input type="text" id="entryTitle-${section.id}" class="form-control" placeholder="Entry title (e.g. Groceries, Rent, SIP name)">
            <input type="number" id="entryAmount-${section.id}" class="form-control" placeholder="Amount" min="0" step="0.01">
            <button class="btn-primary" type="button" onclick="handleAddEntry(${section.id})">Add Entry</button>
          </div>
          <div class="entries-list">
            ${section.entries.length === 0
              ? "<p style='color:gray;font-size:0.9rem;'>No entries yet.</p>"
              : section.entries.map(entry => `
                  <div class="entry-item">
                    <span>${entry.title}</span>
                    <span>₹${entry.amount.toFixed(2)}</span>
                    <button class="delete-btn" onclick="deleteEntry(${section.id}, ${entry.id})">
                      <i class="bi bi-x-circle"></i>
                    </button>
                  </div>
                `).join('')
            }
          </div>
        `;

        sectionsContainer.appendChild(div);
      });
    }

    // Add entry helper
    function handleAddEntry(sectionId) {
      const title = document.getElementById(`entryTitle-${sectionId}`).value.trim();
      const amount = parseFloat(document.getElementById(`entryAmount-${sectionId}`).value);
      if (!title || isNaN(amount) || amount <= 0) return;
      addEntry(sectionId, title, amount);
    }

    // Delete section
    function deleteSection(id) {
      const idx = sections.findIndex(s => s.id === id);
      if (idx !== -1) {
        sections.splice(idx, 1);
        renderSections();
      }
    }
  </script>
</body>
</html>
